<!DOCTYPE html>
<html>
<head>
    <title><%= title %></title>
    <link href="/miniui/themes/default/miniui.css" rel="stylesheet" type="text/css" />
    <style type="text/css">
        body {
            padding-top: 60px;
            padding-bottom: 40px;
        }
    </style>
    <link href="stylesheets/bootstrap-responsive.css" rel="stylesheet">
</head>
<body>
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>
            <a class="brand" href="/">tools</a>

            <div class="nav-collapse">
                <ul class="nav">
                    <li><a href="/">首页</a></li>
                    <li><a href=<%= link %> ><%= link_show %></a></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<h4>选择版本</h4>
<input id="combo1" class="mini-combobox" style="width:150px;" textField="text" valueField="id" emptyText="1.0.0"
       data ="<%= versions %>" value="cn" required="true" allowInput="true" showNullItem="true" nullItemText="请选择..."/>

<h4>选择渠道</h4>
<input id="combo2" class="mini-combobox" style="width:150px;" textField="text"  emptyText="template"
       data ="<%= channels %>" value="cn" required="true" allowInput="true" showNullItem="true" nullItemText="请选择..."
       onvalidation="onComboValidation"/>

<a class="mini-button " plain="true" iconCls="icon-add" onclick="onShow">显示</a>
<a class="mini-button " plain="true" iconCls="icon-add" onclick="onAdd">添加</a>
<a class="mini-button" plain="true" iconCls="icon-remove" onclick="onDel">删除</a>
<a class="mini-button" plain="true" iconCls="icon-remove" onclick="onSave">保存</a>
<br /><br />
<a
    <textarea id="text_area_config" class="mini-textarea"  style="width:800px;height:400px;"  value="<%= activity %>"  emptyText="{config}"></textarea>
    <br /><br />
</a>
<a
    <textarea id="text_area_config_json" class="mini-textarea"  style="width:800px;height:400px;"  value="<%= activity %>"  emptyText="{config}"></textarea>
    <br /><br />
</a>
    <textarea id="text_area_log" class="mini-textarea" class="auto_textarea"  style="width:1605px;height:100px;"  value="ok"  emptyText="{config}"></textarea>
    <br /><br />

<div id="container" class="container">
    <hr/>
    <footer>
        <p><a href="http://blog.chinaunix.net/uid/8625039.html" target="_blank">King Lee</a> 2014</p>
    </footer>
</div>
</body>

<script type="text/javascript">
    //mini.parse();
    function onVersionClick(e) {
        $.ajax({
            url : "/save",
            dataType: 'json',
            cache: false,
            type : "post",
            data : {
                target:"target"
            },
            success : function(json) {
                if(json){
                    alert("ok");
                }else{
                    alert("error");
                }
            }
        });
    }

    function onAdd(e) {
        var obj = mini.get("combo1");
        obj.setValue("usa");

        var button = e.sender;
        var iconCls = button.getIconCls();
        var text = button.getText();
        if (iconCls) {
            alert("text2: " + text + "\nicon: " + iconCls);
        } else {
            alert(text);
        }
    }

    function onDel(e) {
        var obj = mini.get("combo1");
        obj.setValue("usa");

        var button = e.sender;
        var iconCls = button.getIconCls();
        var text = button.getText();
        if (iconCls) {
            alert("text2: " + text + "\nicon: " + iconCls);
        } else {
            alert(text);
        }
    }

    function onValueChanged(e) {
        alert("value changed,not called, why?");
    }

    function onComboValidation(e) {

    }
    function onShow(){
        var comno1 = mini.get("combo1");
        var comno2 = mini.get("combo2");
        var version = comno1.getText();
        var channel = comno2.getText();
        $.ajax({
            url : "/config2",
            dataType: 'json',
            cache: false,
            type : "post",
            data : {
                type:"show",
                version:version,
                channel:channel
            },
            success : function(result) {
                if(result){
                    var text_area_config = mini.get("text_area_config");
                    var text_area_config_json = mini.get("text_area_config_json");
                    var text_area_log = mini.get("text_area_log");
                    switch (result.code)
                    {
                        case 200:
                            if(0){
                                text_area_config.setValue(result.activity);
                            }
                            else{
                                var text_area_config_show_json = jsonToStr(JSON.parse(result.activity), null, '\t');
                                text_area_config_json.setValue(text_area_config_show_json);
                                text_area_config.setValue(result.activity);
                            }
                            text_area_log.setValue("ok");
                            break;
                        case 201:
                            text_area_log.setValue("error code:201,param error");
                            break;
                        case 202:
                            var log = "error code:202,can not find " + version + ":" + channel;
                            text_area_log.setValue(log);
                            text_area_config.setValue("error");
                            break;
                    }
                }else{
                    alert("error");
                }
            }
        });
    }

    function onSave(e) {

        var comno1 = mini.get("combo1");
        var comno2 = mini.get("combo2");
        var version = comno1.getText();
        var channel = comno2.getText();
        var text_area_config = mini.get("text_area_config");
        var text_area_log = mini.get("text_area_log");
        var config = text_area_config.getValue();
        $.ajax({
            url : "/config2",
            dataType: 'json',
            cache: false,
            type : "post",
            data : {
                type:"save",
                version:version,
                channel:channel,
                config:config
            },
            success : function(result) {
                if(result){
                    switch (result.code)
                    {
                        case 200:
                            text_area_log.setValue("ok");
                            break;
                        case 201:
                            text_area_log.setValue("format error");
                            break;
                        case 202:
                            text_area_log.setValue("redis error");
                            break;
                    }
                }else{
                    alert("error");
                }
            }
        });
    }
</script>

<script src="/javascripts/jquery.js"></script>
<script src="/javascripts/util.js" type="text/javascript"></script>
<script src="/miniui/miniui.js" type="text/javascript"></script>
</html>
